<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>MIA Nightclub System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="login-container">
    <h1 class="logo">MIA</h1>
    <p class="subtitle">nightclub system</p>

    <div class="login-box">
        <input type="text" id="usernameInput" placeholder="Benutzername">
        <input type="password" placeholder="Passwort">
        <button class="login-btn" onclick="fakeLogin()">Login</button>
    </div>
</div>

<script>

/* ================= USER ================= */

const USERS = [
    { username: "melven", role: "god" },
    { username: "kevin", role: "superadmin" },
    { username: "lisa", role: "admin" }
];

let currentUser = null;
let uploadedImageData = null;
let editingEventId = null;

/* ================= LOGIN ================= */

function fakeLogin() {
    const username = document.getElementById("usernameInput").value.toLowerCase();
    const found = USERS.find(u => u.username === username);

    if (!found) {
        alert("Unbekannter Benutzer");
        return;
    }

    currentUser = found;
    showInfoScreen();
}

/* ================= INFO SCREEN ================= */

function showInfoScreen() {

    let EVENTS = JSON.parse(localStorage.getItem("mia_events")) || [];

    const today = new Date().toISOString().split("T")[0];
    EVENTS = EVENTS.filter(e => e.date >= today);
    EVENTS.sort((a,b) => new Date(a.date) - new Date(b.date));
    EVENTS = EVENTS.slice(0,6);

    localStorage.setItem("mia_events", JSON.stringify(EVENTS));

    document.body.innerHTML = `
        <div class="top-bar">
            <div class="hamburger" onclick="toggleMenu()">‚ò∞</div>
        </div>

        <div class="side-menu" id="sideMenu">
            <div class="menu-header">MIA System</div>
            ${currentUser.role === "god" ? `<div class="menu-item god-mode" onclick="openGodGate()">GOD Mode</div>` : ""}
            <div class="menu-divider"></div>
            <div class="menu-item logout-item" onclick="logout()">Logout</div>
        </div>

        <div class="event-container">
            ${EVENTS.map((event, index) => `
                <div class="event-card ${index===0?'today':''}">
                    <div class="event-bg" style="background-image:url('${event.image}')"></div>
                    <div class="event-content">
                        <img src="${event.image}" class="event-image">
                        <h2>${event.title}</h2>
                        <p>${event.date}</p>
                        <p>${event.description}</p>
                        ${
                            currentUser.role === "god" || currentUser.role === "superadmin"
                            ? `<div class="event-actions">
                                    <button onclick="editEvent(${event.id})">‚úè</button>
                                    <button onclick="deleteEvent(${event.id})">üóë</button>
                               </div>`
                            : ""
                        }
                    </div>
                </div>
            `).join("")}
        </div>

        ${
            currentUser.role === "god" || currentUser.role === "superadmin"
            ? `<div class="glass-add-btn" onclick="openEventModal()">+</div>`
            : ""
        }

        <!-- EVENT MODAL -->
        <div class="glass-modal" id="eventModal">
            <div class="glass-modal-content">
                <h2 id="modalTitle">Neues Event</h2>
                <input type="text" id="eventTitle" placeholder="Titel">
                <input type="date" id="eventDate">

                <div class="upload-area" id="uploadArea">
                    <p>Bild hier reinziehen oder klicken</p>
                    <input type="file" id="imageInput" accept="image/*" hidden>
                </div>

                <img id="imagePreview" class="image-preview">

                <textarea id="eventDesc" placeholder="Beschreibung"></textarea>

                <button class="login-btn" onclick="saveEvent()">Speichern</button>
                <button class="close-btn" onclick="closeEventModal()">Abbrechen</button>
            </div>
        </div>

        <!-- GOD PIN MODAL -->
        <div class="glass-modal" id="godModal">
            <div class="glass-modal-content">
                <h2>GOD PIN</h2>
                <input type="password" id="godPinInput" placeholder="4-stelliger PIN">
                <button class="login-btn" onclick="checkGodPin()">Best√§tigen</button>
                <button class="close-btn" onclick="closeGodGate()">Abbrechen</button>
            </div>
        </div>
    `;

    setTimeout(setupImageUpload, 50);
}

/* ================= MENU ================= */

function toggleMenu() {
    document.getElementById("sideMenu").classList.toggle("active");
}

function logout() {
    location.reload();
}

/* ================= GOD PIN ================= */

function openGodGate() {
    document.getElementById("godModal").classList.add("active");
}

function closeGodGate() {
    document.getElementById("godModal").classList.remove("active");
}

function checkGodPin() {
    const pin = document.getElementById("godPinInput").value;
    if (pin === "1337") {
        alert("Willkommen im GOD Dashboard üòé");
        closeGodGate();
    } else {
        alert("Falscher PIN");
    }
}

/* ================= IMAGE UPLOAD ================= */

function setupImageUpload() {
    const uploadArea = document.getElementById("uploadArea");
    const imageInput = document.getElementById("imageInput");
    const preview = document.getElementById("imagePreview");

    if (!uploadArea) return;

    uploadArea.onclick = () => imageInput.click();

    imageInput.onchange = e => handleFile(e.target.files[0]);

    uploadArea.ondragover = e => {
        e.preventDefault();
        uploadArea.classList.add("dragging");
    };

    uploadArea.ondragleave = () => uploadArea.classList.remove("dragging");

    uploadArea.ondrop = e => {
        e.preventDefault();
        uploadArea.classList.remove("dragging");
        handleFile(e.dataTransfer.files[0]);
    };

    function handleFile(file) {
        const reader = new FileReader();
        reader.onload = function (event) {
            uploadedImageData = event.target.result;
            preview.src = uploadedImageData;
            preview.style.display = "block";
        };
        reader.readAsDataURL(file);
    }
}

/* ================= EVENTS ================= */

function openEventModal() {
    editingEventId = null;
    uploadedImageData = null;
    document.getElementById("modalTitle").innerText = "Neues Event";
    document.getElementById("eventModal").classList.add("active");
}

function closeEventModal() {
    document.getElementById("eventModal").classList.remove("active");
}

function saveEvent() {

    let EVENTS = JSON.parse(localStorage.getItem("mia_events")) || [];

    const eventData = {
        id: editingEventId || Date.now(),
        title: document.getElementById("eventTitle").value,
        date: document.getElementById("eventDate").value,
        description: document.getElementById("eventDesc").value,
        image: uploadedImageData || ""
    };

    if (!eventData.title || !eventData.date) {
        alert("Titel & Datum sind Pflicht!");
        return;
    }

    if (editingEventId) {
        EVENTS = EVENTS.map(e => e.id === editingEventId ? eventData : e);
    } else {
        EVENTS.push(eventData);
    }

    localStorage.setItem("mia_events", JSON.stringify(EVENTS));
    closeEventModal();
    showInfoScreen();
}

function editEvent(id) {
    let EVENTS = JSON.parse(localStorage.getItem("mia_events")) || [];
    const event = EVENTS.find(e => e.id === id);

    editingEventId = id;
    uploadedImageData = event.image;

    document.getElementById("modalTitle").innerText = "Event bearbeiten";
    document.getElementById("eventTitle").value = event.title;
    document.getElementById("eventDate").value = event.date;
    document.getElementById("eventDesc").value = event.description;

    const preview = document.getElementById("imagePreview");
    preview.src = event.image;
    preview.style.display = "block";

    document.getElementById("eventModal").classList.add("active");
}

function deleteEvent(id) {
    if (!confirm("Event wirklich l√∂schen?")) return;

    let EVENTS = JSON.parse(localStorage.getItem("mia_events")) || [];
    EVENTS = EVENTS.filter(e => e.id !== id);

    localStorage.setItem("mia_events", JSON.stringify(EVENTS));
    showInfoScreen();
}

</script>

</body>
</html>
