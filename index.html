<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>MIA Nightclub System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">
</head>
<body>

<div id="app">

    <!-- GLOBAL OVERLAY -->
    <div id="globalOverlay" class="overlay hidden"></div>

    <!-- LOGIN VIEW -->
    <div id="loginView" class="view active">
        <h1 class="logo">MIA</h1>
        <p class="subtitle">nightclub system</p>

        <div class="login-box">
            <input type="text" id="usernameInput" placeholder="Benutzername">
            <input type="password" placeholder="Passwort">
            <button class="login-btn" onclick="login()">Login</button>
        </div>
    </div>

    <!-- MAIN VIEW -->
    <div id="mainView" class="view">

        <div class="top-bar">
            <div class="hamburger" onclick="toggleMenu()">‚ò∞</div>
        </div>

        <div id="eventContainer" class="event-container"></div>

        <div id="addButton" class="glass-add-btn hidden" onclick="openEventModal()">+</div>
    </div>

    <!-- SIDE MENU -->
    <div id="sideMenu" class="side-menu">
        <div class="menu-header">MIA System</div>
        <div class="menu-item">Info</div>
        <div class="menu-item">Barkeeper</div>
        <div class="menu-item">Runner</div>
        <div class="menu-item">Getr√§nkekarte</div>
        <div class="menu-item">Einstellungen</div>
        <div id="godMenuItem" class="menu-item god-mode hidden" onclick="openGodGate()">GOD Mode</div>
        <div class="menu-divider"></div>
        <div class="menu-item logout-item" onclick="logout()">Logout</div>
    </div>

    <!-- EVENT MODAL -->
    <div id="eventModal" class="modal hidden">
        <div class="modal-box">
            <h2 id="modalTitle">Neues Event</h2>

            <input type="text" id="eventTitle" placeholder="Titel">
            <input type="date" id="eventDate">

            <div id="uploadArea" class="upload-area">
                <p>Bild hier reinziehen oder klicken</p>
                <input type="file" id="imageInput" accept="image/*" hidden>
            </div>

            <img id="imagePreview" class="image-preview">

            <textarea id="eventDesc" placeholder="Beschreibung"></textarea>

            <button class="login-btn" onclick="saveEvent()">Speichern</button>
        </div>
    </div>

    <!-- GOD PIN MODAL -->
    <div id="godModal" class="modal hidden">
        <div class="modal-box">
            <h2>GOD PIN</h2>
            <input type="password" id="godPinInput" placeholder="4-stelliger PIN">
            <button class="login-btn" onclick="checkGodPin()">Best√§tigen</button>
        </div>
    </div>

</div>

<script>

/* ================= SYSTEM ================= */

const USERS = [
    { username: "melven", role: "god" },
    { username: "kevin", role: "superadmin" }
];

let currentUser = null;
let uploadedImage = null;
let editingEventId = null;

/* ================= VIEW CONTROL ================= */

function showView(id) {
    document.querySelectorAll(".view").forEach(v => v.classList.remove("active"));
    document.getElementById(id).classList.add("active");
}

/* ================= LOGIN ================= */

function login() {
    const name = document.getElementById("usernameInput").value.toLowerCase();
    const user = USERS.find(u => u.username === name);

    if (!user) return alert("Unbekannter Benutzer");

    currentUser = user;
    showView("mainView");
    initMainUI();
}

/* ================= MAIN UI ================= */

function initMainUI() {
    if (currentUser.role === "god" || currentUser.role === "superadmin") {
        document.getElementById("addButton").classList.remove("hidden");
    }

    if (currentUser.role === "god") {
        document.getElementById("godMenuItem").classList.remove("hidden");
    }

    renderEvents();
}

/* ================= EVENTS ================= */

function renderEvents() {

    let events = JSON.parse(localStorage.getItem("mia_events")) || [];
    const today = new Date().toISOString().split("T")[0];

    events = events.filter(e => e.date >= today);
    events.sort((a,b)=>new Date(a.date)-new Date(b.date));
    events = events.slice(0,6);

    localStorage.setItem("mia_events", JSON.stringify(events));

    const container = document.getElementById("eventContainer");
    container.innerHTML = events.map((event, i) => `
        <div class="event-card ${i===0?'today':''}">
            <div class="event-bg" style="background-image:url('${event.image}')"></div>
            <div class="event-content">
                <img src="${event.image}" class="event-image">
                <h2>${event.title}</h2>
                <p>${event.date}</p>
                <p>${event.description}</p>

                ${
                    currentUser.role === "god" || currentUser.role === "superadmin"
                    ? `<div class="event-actions">
                           <button onclick="editEvent(${event.id})">Bearbeiten</button>
                           <button onclick="deleteEvent(${event.id})">L√∂schen</button>
                       </div>`
                    : ""
                }
            </div>
        </div>
    `).join("");
}

/* ================= MODALS ================= */

function openEventModal() {
    editingEventId = null;
    document.getElementById("eventModal").classList.remove("hidden");
    document.getElementById("globalOverlay").classList.remove("hidden");
}

function openGodGate() {
    document.getElementById("godModal").classList.remove("hidden");
    document.getElementById("globalOverlay").classList.remove("hidden");
}

document.getElementById("globalOverlay").onclick = () => {
    document.querySelectorAll(".modal").forEach(m => m.classList.add("hidden"));
    document.getElementById("sideMenu").classList.remove("active");
    document.getElementById("globalOverlay").classList.add("hidden");
};

/* ================= MENU ================= */

function toggleMenu() {
    document.getElementById("sideMenu").classList.toggle("active");
    document.getElementById("globalOverlay").classList.toggle("hidden");
}

/* ================= GOD ================= */

function checkGodPin() {
    if (document.getElementById("godPinInput").value === "1337") {
        alert("GOD Dashboard coming soon üòé");
    } else {
        alert("Falscher PIN");
    }
}

/* ================= SAVE / EDIT / DELETE ================= */

function saveEvent() {
    let events = JSON.parse(localStorage.getItem("mia_events")) || [];

    const newEvent = {
        id: editingEventId || Date.now(),
        title: eventTitle.value,
        date: eventDate.value,
        description: eventDesc.value,
        image: uploadedImage || ""
    };

    if (!newEvent.title || !newEvent.date) return alert("Titel & Datum Pflicht");

    if (editingEventId) {
        events = events.map(e => e.id === editingEventId ? newEvent : e);
    } else {
        events.push(newEvent);
    }

    localStorage.setItem("mia_events", JSON.stringify(events));
    closeAll();
    renderEvents();
}

function editEvent(id) {
    const events = JSON.parse(localStorage.getItem("mia_events")) || [];
    const event = events.find(e => e.id === id);

    editingEventId = id;
    eventTitle.value = event.title;
    eventDate.value = event.date;
    eventDesc.value = event.description;
    uploadedImage = event.image;
    imagePreview.src = event.image;
    imagePreview.style.display = "block";

    openEventModal();
}

function deleteEvent(id) {
    if (!confirm("Event l√∂schen?")) return;
    let events = JSON.parse(localStorage.getItem("mia_events")) || [];
    events = events.filter(e => e.id !== id);
    localStorage.setItem("mia_events", JSON.stringify(events));
    renderEvents();
}

function closeAll(){
    document.querySelectorAll(".modal").forEach(m=>m.classList.add("hidden"));
    document.getElementById("globalOverlay").classList.add("hidden");
}

/* ================= IMAGE UPLOAD ================= */

uploadArea.onclick = ()=> imageInput.click();

imageInput.onchange = e=>{
    const reader = new FileReader();
    reader.onload = ev=>{
        uploadedImage = ev.target.result;
        imagePreview.src = uploadedImage;
        imagePreview.style.display="block";
    };
    reader.readAsDataURL(e.target.files[0]);
};

uploadArea.ondragover = e=>{
    e.preventDefault();
    uploadArea.classList.add("dragging");
};

uploadArea.ondrop = e=>{
    e.preventDefault();
    uploadArea.classList.remove("dragging");
    const reader = new FileReader();
    reader.onload = ev=>{
        uploadedImage = ev.target.result;
        imagePreview.src = uploadedImage;
        imagePreview.style.display="block";
    };
    reader.readAsDataURL(e.dataTransfer.files[0]);
};

</script>

</body>
</html>
