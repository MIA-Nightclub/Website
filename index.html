<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>MIA Nightclub System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">
</head>

<body>

<!-- ================= LOGIN VIEW ================= -->

<div id="loginView" class="view active">

    <h1 class="logo">MIA</h1>
    <p class="subtitle">nightclub system</p>

    <div class="login-box">
        <input id="usernameInput" type="text" placeholder="Benutzername">
        <button class="login-btn" onclick="login()">Login</button>
        <button class="register-btn" onclick="openRegister()">Registrieren</button>
    </div>

</div>

<!-- ================= MAIN VIEW ================= -->

<div id="mainView" class="view">

    <div class="top-bar">
        <div class="hamburger" onclick="toggleMenu()">‚ò∞</div>
    </div>

    <div id="sideMenu" class="side-menu">
        <div class="menu-header">MIA System</div>
        <div class="menu-item">Info</div>
        <div class="menu-item">Barkeeper</div>
        <div class="menu-item">Runner</div>
        <div class="menu-item">Getr√§nkekarte</div>
        <div class="menu-item">Einstellungen</div>
        <div class="menu-divider"></div>
        <div id="godMenuItem" class="menu-item god-mode hidden" onclick="openGodGate()">GOD Mode</div>
        <div class="menu-item logout-item" onclick="logout()">Logout</div>
    </div>

    <div id="eventContainer" class="event-container"></div>

    <div id="addButton" class="glass-add-btn hidden" onclick="openEventModal()">+</div>

</div>

<!-- ================= REGISTER MODAL ================= -->

<div id="registerModal" class="modal hidden">
    <div class="modal-box">
        <h2>Registrieren</h2>
        <input type="text" placeholder="Benutzername">
        <input type="password" placeholder="Passwort">
        <button class="login-btn">Account erstellen</button>
    </div>
</div>

<!-- ================= EVENT MODAL ================= -->

<div id="eventModal" class="modal hidden">
    <div class="modal-box">
        <h2>Neues Event</h2>
        <input id="eventTitle" type="text" placeholder="Titel">
        <input id="eventDate" type="date">
        <textarea id="eventDesc" placeholder="Beschreibung"></textarea>

        <div id="uploadArea" class="upload-area">
            Bild hier klicken
        </div>

        <input type="file" id="imageInput" hidden>
        <img id="imagePreview" class="image-preview">

        <button class="login-btn" onclick="saveEvent()">Speichern</button>
    </div>
</div>

<!-- ================= GOD PIN MODAL ================= -->

<div id="godModal" class="modal hidden">
    <div class="modal-box">
        <h2>GOD PIN</h2>
        <input id="godPinInput" type="password" placeholder="4-stelliger PIN">
        <button class="login-btn" onclick="checkGodPin()">Best√§tigen</button>
    </div>
</div>

<!-- ================= SCRIPT ================= -->

<script>

const USERS = [
    { username: "melven", role: "god" },
    { username: "kevin", role: "superadmin" }
];

let currentUser = null;
let uploadedImage = null;

/* ================= LOGIN ================= */

function login() {
    const name = usernameInput.value.toLowerCase();
    const user = USERS.find(u => u.username === name);
    if (!user) return alert("Unbekannter Benutzer");

    currentUser = user;
    loginView.classList.remove("active");
    mainView.classList.add("active");

    if (user.role === "god" || user.role === "superadmin") {
        addButton.classList.remove("hidden");
    }

    if (user.role === "god") {
        godMenuItem.classList.remove("hidden");
    }

    renderEvents();
}

function logout() {
    location.reload();
}

/* ================= MENU ================= */

function toggleMenu() {
    sideMenu.classList.toggle("active");
}

/* ================= EVENTS ================= */

function renderEvents() {
    let events = JSON.parse(localStorage.getItem("mia_events")) || [];

    const today = new Date().toISOString().split("T")[0];
    events = events.filter(e => e.date >= today);
    events.sort((a,b)=>new Date(a.date)-new Date(b.date));
    events = events.slice(0,6);

    localStorage.setItem("mia_events", JSON.stringify(events));

    eventContainer.innerHTML = events.map((event,i)=>`
        <div class="event-card ${i===0?'today':''}">
            <div class="event-bg" style="background-image:url('${event.image}')"></div>
            <div class="event-content">
                <img src="${event.image}" class="event-image">
                <h2>${event.title}</h2>
                <p>${event.date}</p>
                <p>${event.description}</p>
                ${
                    currentUser.role==="god" || currentUser.role==="superadmin"
                    ? `<div class="event-actions">
                         <button onclick="deleteEvent(${event.id})">L√∂schen</button>
                       </div>`
                    : ""
                }
            </div>
        </div>
    `).join("");
}

function saveEvent() {
    let events = JSON.parse(localStorage.getItem("mia_events")) || [];

    const newEvent = {
        id: Date.now(),
        title: eventTitle.value,
        date: eventDate.value,
        description: eventDesc.value,
        image: uploadedImage || ""
    };

    if (!newEvent.title || !newEvent.date) return alert("Titel & Datum Pflicht");

    events.push(newEvent);
    localStorage.setItem("mia_events", JSON.stringify(events));

    closeAll();
    renderEvents();
}

function deleteEvent(id) {
    let events = JSON.parse(localStorage.getItem("mia_events")) || [];
    events = events.filter(e=>e.id!==id);
    localStorage.setItem("mia_events", JSON.stringify(events));
    renderEvents();
}

/* ================= MODALS ================= */

function openRegister(){ registerModal.classList.remove("hidden"); }
function openEventModal(){ eventModal.classList.remove("hidden"); }
function openGodGate(){ godModal.classList.remove("hidden"); }

function closeAll(){
    document.querySelectorAll(".modal").forEach(m=>m.classList.add("hidden"));
    sideMenu.classList.remove("active");
}

/* ================= GOD PIN ================= */

function checkGodPin(){
    if(godPinInput.value==="1337"){
        alert("GOD Dashboard coming soon üòé");
    } else {
        alert("Falscher PIN");
    }
}

/* ================= OUTSIDE CLICK ================= */

document.addEventListener("click", function(e){

    document.querySelectorAll(".modal").forEach(modal=>{
        const box = modal.querySelector(".modal-box");
        if(!modal.classList.contains("hidden")){
            if(!box.contains(e.target)){
                modal.classList.add("hidden");
            }
        }
    });

    if(sideMenu.classList.contains("active") &&
       !sideMenu.contains(e.target) &&
       !e.target.classList.contains("hamburger")){
        sideMenu.classList.remove("active");
    }

});

/* ================= IMAGE UPLOAD SAFE ================= */

document.addEventListener("click", function(e){
    if(e.target.id==="uploadArea"){
        imageInput.click();
    }
});

document.addEventListener("change", function(e){
    if(e.target.id==="imageInput"){
        const reader = new FileReader();
        reader.onload = function(ev){
            uploadedImage = ev.target.result;
            imagePreview.src = uploadedImage;
            imagePreview.style.display="block";
        };
        reader.readAsDataURL(e.target.files[0]);
    }
});

</script>

</body>
</html>
